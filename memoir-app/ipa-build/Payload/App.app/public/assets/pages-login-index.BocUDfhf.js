import{c as e,w as s,s as o,n as a,r as t,u as r,q as i,i as l,o as n,a as d,e as c,d as u,B as f,I as p,m as g,t as h,h as m}from"./index-DQU_JAH0.js";import{a as w}from"./apiConfig.BpiTqs15.js";import{_}from"./_plugin-vue_export-helper.BCo6x5W8.js";const k=_({data:()=>({loginForm:{identifier:"",password:""},errors:{},isLoading:!1}),mounted(){this.errors={}},methods:{updateIdentifier(e){this.loginForm.identifier=e.detail.value||e.target.value||"",this.errors.identifier=""},updatePassword(e){this.loginForm.password=e.detail.value||e.target.value||"",this.errors.password=""},validateForm(){return this.errors={},this.loginForm.identifier.trim()||(this.errors.identifier="请输入用户名或邮箱"),this.loginForm.password.trim()||(this.errors.password="请输入密码"),0===Object.keys(this.errors).length},async handleLogin(){if(this.validateForm()){this.isLoading=!0;try{const e=w("/auth/login");console.log("🔐 [Login] 准备发送登录请求..."),console.log("🌐 [Login] 请求 URL:",e),console.log("📱 [Login] 当前环境检测:",{isCapacitor:!!window.Capacitor,userAgent:navigator.userAgent,location:window.location.href});const s=await t({url:e,method:"POST",header:{"Content-Type":"application/json"},data:{identifier:this.loginForm.identifier.trim(),password:this.loginForm.password}});console.log("登录响应:",s);const a=s.data;if(200!==s.statusCode&&201!==s.statusCode)throw 400===s.statusCode||401===s.statusCode?new Error(a.message||"用户名或密码错误"):new Error("网络请求失败");if(!a.success)throw new Error(a.message||"登录失败");r("token",a.data.token),r("user",a.data.user),i({title:"登录成功",icon:"success"}),setTimeout(()=>{o({url:"/pages/profile/index"})},1500)}catch(e){console.error("登录失败:",e),i({title:e.message||"登录失败，请重试",icon:"none",duration:2e3})}finally{this.isLoading=!1}}},goToRegister(){a({url:"/pages/register/index"})},goBack(){o({url:"/pages/profile/index"})}}},[["render",function(o,a,t,r,i,w){const _=c,k=l,C=p,v=m;return n(),e(k,{class:"container"},{default:s(()=>[d(k,{class:"back-btn",onClick:w.goBack},{default:s(()=>[d(_,{class:"back-icon"},{default:s(()=>[u("←")]),_:1})]),_:1},8,["onClick"]),d(k,{class:"login-header"},{default:s(()=>[d(k,{class:"app-title"},{default:s(()=>[u("岁月镜像")]),_:1}),d(k,{class:"app-subtitle"},{default:s(()=>[u("记录生命中的每一个珍贵瞬间")]),_:1})]),_:1}),d(k,{class:"login-form"},{default:s(()=>[d(k,{class:"form-title"},{default:s(()=>[u("欢迎回来")]),_:1}),d(k,{class:"input-group"},{default:s(()=>[d(k,{class:"input-container"},{default:s(()=>[d(C,{class:g(["input-field",{error:i.errors.identifier}]),type:"text",placeholder:"请输入用户名或邮箱",value:i.loginForm.identifier,onInput:w.updateIdentifier,autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false"},null,8,["value","onInput","class"])]),_:1}),i.errors.identifier?(n(),e(_,{key:0,class:"error-text"},{default:s(()=>[u(h(i.errors.identifier),1)]),_:1})):f("",!0)]),_:1}),d(k,{class:"input-group"},{default:s(()=>[d(k,{class:"input-container"},{default:s(()=>[d(C,{class:g(["input-field",{error:i.errors.password}]),type:"password",placeholder:"请输入密码",value:i.loginForm.password,onInput:w.updatePassword,autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false"},null,8,["value","onInput","class"])]),_:1}),i.errors.password?(n(),e(_,{key:0,class:"error-text"},{default:s(()=>[u(h(i.errors.password),1)]),_:1})):f("",!0)]),_:1}),d(k,{class:"btn-container"},{default:s(()=>[d(v,{class:"login-btn",onClick:w.handleLogin,disabled:i.isLoading},{default:s(()=>[u(h(i.isLoading?"登录中...":"登录"),1)]),_:1},8,["onClick","disabled"])]),_:1}),d(k,{class:"form-footer"},{default:s(()=>[d(_,{class:"register-text"},{default:s(()=>[u("还没有账号？")]),_:1}),d(_,{class:"register-link",onClick:w.goToRegister},{default:s(()=>[u("立即注册")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})}],["__scopeId","data-v-d60c96f5"]]);export{k as default};
