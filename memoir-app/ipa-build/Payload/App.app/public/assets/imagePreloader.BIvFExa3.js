import{g as e}from"./imageMapping.mDgfjL7P.js";const s=new class{constructor(){this.cache=new Map,this.loadingPromises=new Map}preload(e,s={}){if(!e)return Promise.reject(new Error("图片路径不能为空"));if(this.cache.has(e))return Promise.resolve(this.cache.get(e));if(this.loadingPromises.has(e))return this.loadingPromises.get(e);const r=this._loadImage(e,s);return this.loadingPromises.set(e,r),r}preloadBatch(e,s={}){if(!Array.isArray(e))return Promise.reject(new Error("图片路径必须是数组"));const r=e.map(e=>this.preload(e,s));return Promise.allSettled(r)}preloadCritical(s=[]){const r=(s.length>0?s:["/src/images/memoirbook.png","/src/images/lion.png","/src/images/winter.png","/src/images/story1.png","/src/images/story2.png"]).map(s=>e(s));return this.preloadBatch(r,{priority:"high"})}preloadChapterImages(s=[]){const r=(s.length>0?s:["/src/images/story1.png","/src/images/story2.png","/src/images/story3.png","/src/images/story4.png","/src/images/story5.png","/src/images/story6.png","/src/images/story7.png","/src/images/story8.png","/src/images/story9.png","/src/images/story10.png"]).map(s=>e(s));return this.preloadBatch(r,{priority:"low"})}_loadImage(e,s={}){return new Promise((r,t)=>{const i=new Image;i.onload=()=>{this.cache.set(e,{src:e,loaded:!0,timestamp:Date.now(),...s}),this.loadingPromises.delete(e),r(this.cache.get(e))},i.onerror=r=>{this.cache.set(e,{src:e,loaded:!1,error:r,timestamp:Date.now(),...s}),this.loadingPromises.delete(e),t(r)},"high"===s.priority?i.loading="eager":i.loading="lazy",i.src=e})}getCache(e){return this.cache.get(e)||null}clearCache(e=null){e?(this.cache.delete(e),this.loadingPromises.delete(e)):(this.cache.clear(),this.loadingPromises.clear())}getStats(){const e=this.cache.size,s=Array.from(this.cache.values()).filter(e=>e.loaded).length;return{total:e,loaded:s,loading:this.loadingPromises.size,failed:e-s}}};export{s as i};
