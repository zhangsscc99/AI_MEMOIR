import{c as e,w as a,q as t,g as s,u as i,v as r,x as o,r as l,y as c,n as d,z as n,A as u,i as g,o as m,a as h,d as p,j as y,k as f,B as D,F as _,l as I,b as k,t as $,C as b,h as w,e as C}from"./index-DQU_JAH0.js";import{a as v}from"./apiConfig.BpiTqs15.js";import{g as F}from"./imageMapping.mDgfjL7P.js";import{_ as j}from"./_plugin-vue_export-helper.BCo6x5W8.js";const x=j({data:()=>({diaries:[]}),onShow(){this.loadDiaries()},methods:{getOptimalImagePath:F,async loadDiaries(){try{console.log("ğŸ”„ å¼€å§‹åŠ è½½éšè®°æ•°æ®...");const e=s("user"),a=null==e?void 0:e.id;a&&(u(`diaries_${a}`),u(`currentDiary_${a}`)),u("diaries"),u("currentDiary");const t=s("token");if(!t){console.log("âŒ æœªç™»å½•ï¼Œä½¿ç”¨æœ¬åœ°å­˜å‚¨æ•°æ®");const e=a?s(`diaries_${a}`)||[]:s("diaries")||[];return void(this.diaries=e)}const i=await l({url:v("/chapters"),method:"GET",header:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(console.log("ğŸ“Š åç«¯ç« èŠ‚å“åº”:",i),console.log("ğŸ“Š å“åº”æ•°æ®è¯¦æƒ…:",i.data),200===i.statusCode&&i.data.success){const e=i.data.data||{};console.log("ğŸ“Š åŸå§‹æ•°æ®ç±»å‹:",typeof e,"æ˜¯å¦ä¸ºæ•°ç»„:",Array.isArray(e)),console.log("ğŸ“Š åŸå§‹æ•°æ®å†…å®¹:",e);const a=(e.chapters||[]).filter(e=>e.chapterId&&e.chapterId.startsWith("diary_"));console.log("ğŸ“– è¿‡æ»¤å‡ºçš„diaryç« èŠ‚:",a),this.diaries=a.map(e=>({id:e.id,chapterId:e.chapterId,title:e.title||"æ— æ ‡é¢˜éšè®°",content:e.content||"",image:e.backgroundImage&&!e.backgroundImage.startsWith("blob:")?e.backgroundImage.startsWith("http")?e.backgroundImage:F(e.backgroundImage):"/src/images/default-diary.svg",createTime:e.updatedAt||e.createdAt,chapterData:e}));const t=this.getDefaultDiaries();console.log("ğŸ¦ æ·»åŠ æ ·æ¿æ¡ˆä¾‹:",t),this.diaries=this.diaries.concat(t),console.log("âœ… éšè®°æ•°æ®åŠ è½½å®Œæˆï¼Œæ€»æ•°:",this.diaries.length,"æ•°æ®:",this.diaries)}else{console.log("âŒ è·å–éšè®°å¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°å­˜å‚¨æ•°æ®:",i.data);const e=a?s(`diaries_${a}`)||[]:s("diaries")||[];this.diaries=e.concat(this.getDefaultDiaries())}}catch(e){console.error("âŒ åŠ è½½éšè®°å‡ºé”™ï¼Œä½¿ç”¨æœ¬åœ°å­˜å‚¨æ•°æ®:",e);const a=userId?s(`diaries_${userId}`)||[]:s("diaries")||[];this.diaries=a.concat(this.getDefaultDiaries())}},getDefaultDiaries:()=>[{id:"sample_diary_1",title:"æ˜¥èŠ‚èˆç‹®å­",content:"èˆç‹®å­æ˜¯ä¸­å›½ä¼ ç»Ÿæ°‘é—´è‰ºæœ¯ï¼Œåœ¨æ˜¥èŠ‚æœŸé—´å°¤ä¸ºç››è¡Œã€‚ç‹®å­è±¡å¾ç€å¨æ­¦å’Œå‰ç¥¥ï¼Œèˆç‹®è¡¨æ¼”å¯“æ„é©±é‚ªé¿å®³ã€ç¥ˆæ±‚å¹³å®‰ã€‚è¡¨æ¼”è€…éœ€è¦é…åˆé»˜å¥‘ï¼Œé€šè¿‡ç²¾æ¹›çš„æŠ€è‰ºå±•ç°ç‹®å­çš„å¨æ­¦å’ŒçµåŠ¨ï¼Œä¸ºèŠ‚æ—¥å¢æ·»å–œåº†æ°›å›´ã€‚",image:F("/src/images/lion.png"),createTime:(new Date).toISOString(),chapterData:{chapterId:"sample_diary_1",title:"æ˜¥èŠ‚èˆç‹®å­",content:"èˆç‹®å­æ˜¯ä¸­å›½ä¼ ç»Ÿæ°‘é—´è‰ºæœ¯ï¼Œåœ¨æ˜¥èŠ‚æœŸé—´å°¤ä¸ºç››è¡Œã€‚ç‹®å­è±¡å¾ç€å¨æ­¦å’Œå‰ç¥¥ï¼Œèˆç‹®è¡¨æ¼”å¯“æ„é©±é‚ªé¿å®³ã€ç¥ˆæ±‚å¹³å®‰ã€‚è¡¨æ¼”è€…éœ€è¦é…åˆé»˜å¥‘ï¼Œé€šè¿‡ç²¾æ¹›çš„æŠ€è‰ºå±•ç°ç‹®å­çš„å¨æ­¦å’ŒçµåŠ¨ï¼Œä¸ºèŠ‚æ—¥å¢æ·»å–œåº†æ°›å›´ã€‚",backgroundImage:F("/src/images/lion.png"),status:"completed"}}],addNewDiary(){d({url:"/pages/diary/edit"})},viewDiary(e){console.log("æŸ¥çœ‹éšè®°:",e);const a=s("user"),t=null==a?void 0:a.id;t&&i(`currentDiary_${t}`,e),i("currentDiary",e),d({url:`/pages/diary/edit?chapterId=${e.chapterId}&title=${encodeURIComponent(e.title)}&mode=view`})},showDiaryMenu(e){n({itemList:["ç¼–è¾‘","åˆ é™¤","åˆ†äº«"],success:a=>{switch(a.tapIndex){case 0:this.editDiary(e);break;case 1:this.deleteDiary(e);break;case 2:this.shareDiary(e)}}})},editDiary(e){console.log("ç¼–è¾‘éšè®°:",e);const a=s("user"),t=null==a?void 0:a.id;t&&i(`currentDiary_${t}`,e),i("currentDiary",e),d({url:`/pages/diary/edit?chapterId=${e.chapterId}&title=${encodeURIComponent(e.title)}&mode=edit`})},deleteDiary(e){c({title:"ç¡®è®¤åˆ é™¤",content:"ç¡®å®šè¦åˆ é™¤è¿™æ¡éšè®°å—ï¼Ÿ",success:a=>{a.confirm&&this.performDelete(e)}})},async performDelete(e){if(e.id.startsWith("sample_"))this.deleteFromLocal(e);else try{r({title:"åˆ é™¤ä¸­..."});const a=s("token");if(!a)return o(),void t({title:"è¯·å…ˆç™»å½•",icon:"error"});const i=await l({url:v(`/chapters/${e.id}`),method:"DELETE",header:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}});o(),200===i.statusCode&&i.data.success?(this.loadDiaries(),t({title:"åˆ é™¤æˆåŠŸ",icon:"success"})):(console.log("åç«¯åˆ é™¤å¤±è´¥ï¼Œå°è¯•æœ¬åœ°åˆ é™¤:",i.data),this.deleteFromLocal(e))}catch(a){console.error("åˆ é™¤éšè®°å‡ºé”™:",a),o(),c({title:"ç½‘ç»œé”™è¯¯",content:"æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œæ˜¯å¦ä»…ä»æœ¬åœ°åˆ é™¤ï¼Ÿ",success:a=>{a.confirm&&this.deleteFromLocal(e)}})}},deleteFromLocal(e){try{const a=s("user"),r=null==a?void 0:a.id,o=r?s(`diaries_${r}`)||[]:s("diaries")||[],l=o.findIndex(a=>a.id===e.id);l>-1&&(o.splice(l,1),r&&i(`diaries_${r}`,o),i("diaries",o),this.loadDiaries(),t({title:"æœ¬åœ°åˆ é™¤æˆåŠŸ",icon:"success"}))}catch(a){console.error("æœ¬åœ°åˆ é™¤å¤±è´¥:",a),t({title:"åˆ é™¤å¤±è´¥",icon:"error"})}},shareDiary(e){t({title:"åˆ†äº«åŠŸèƒ½å¼€å‘ä¸­",icon:"none"})},formatDate(e){const a=new Date(e);return`${a.getFullYear()}/${(a.getMonth()+1).toString().padStart(2,"0")}/${a.getDate().toString().padStart(2,"0")}`}}},[["render",function(t,s,i,r,o,l){const c=g,d=k,n=C,u=w;return m(),e(c,{class:"container"},{default:a(()=>[h(c,{class:"page-header"},{default:a(()=>[h(c,{class:"page-title"},{default:a(()=>[p("éšè®°")]),_:1}),h(c,{class:"page-subtitle"},{default:a(()=>[p("è®°å½•ç…§ç‰‡é‡Œçš„æ•…äº‹ï¼Œéšæ‰‹å†™ä¸‹ç”Ÿæ´»ç‚¹æ»´ã€‚"),y("br"),p("è½»æ¾å¯¼å…¥å›å¿†å½•")]),_:1})]),_:1}),h(c,{class:"diary-list"},{default:a(()=>[(m(!0),f(_,null,I(o.diaries,t=>(m(),e(c,{class:"diary-item",key:t.id,onClick:e=>l.viewDiary(t)},{default:a(()=>[h(d,{src:l.getOptimalImagePath(t.image||"/src/images/lion.png"),class:"diary-image",mode:"aspectFill"},null,8,["src"]),h(c,{class:"diary-content"},{default:a(()=>[h(c,{class:"diary-title"},{default:a(()=>[p($(t.title),1)]),_:2},1024),h(c,{class:"diary-date"},{default:a(()=>[p($(l.formatDate(t.createTime)),1)]),_:2},1024)]),_:2},1024),h(c,{class:"diary-menu",onClick:b(e=>l.showDiaryMenu(t),["stop"])},{default:a(()=>[h(c,{class:"menu-dot"}),h(c,{class:"menu-dot"}),h(c,{class:"menu-dot"})]),_:2},1032,["onClick"])]),_:2},1032,["onClick"]))),128)),0===o.diaries.length?(m(),e(c,{key:0,class:"diary-item"},{default:a(()=>[h(d,{src:l.getOptimalImagePath("/src/images/lion.png"),class:"diary-image",mode:"aspectFill"},null,8,["src"]),h(c,{class:"diary-content"},{default:a(()=>[h(c,{class:"diary-title"},{default:a(()=>[p("ç¤ºä¾‹ï¼šæ˜¥èŠ‚ç¦å­—çš„æ•…äº‹")]),_:1}),h(c,{class:"diary-date"},{default:a(()=>[p("2025/08/25")]),_:1})]),_:1}),h(c,{class:"diary-menu"},{default:a(()=>[h(c,{class:"menu-dot"}),h(c,{class:"menu-dot"}),h(c,{class:"menu-dot"})]),_:1})]),_:1})):D("",!0)]),_:1}),h(c,{class:"add-btn-container"},{default:a(()=>[h(u,{class:"add-btn",onClick:l.addNewDiary},{default:a(()=>[h(n,{class:"add-icon"},{default:a(()=>[p("+")]),_:1}),h(n,{class:"add-text"},{default:a(()=>[p("æ–°éšè®°")]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1})}],["__scopeId","data-v-cac7e718"]]);export{x as default};
