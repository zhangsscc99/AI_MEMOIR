import{c as e,w as r,s,D as a,r as t,u as o,q as i,i as l,o as n,a as u,e as d,d as c,B as m,I as p,m as f,t as g,h}from"./index-DQU_JAH0.js";import{a as w}from"./apiConfig.BpiTqs15.js";import{_}from"./_plugin-vue_export-helper.BCo6x5W8.js";const F=_({data:()=>({registerForm:{username:"",email:"",password:"",confirmPassword:""},errors:{},isLoading:!1}),created(){this.errors={},console.log("注册页面初始化，表单数据:",this.registerForm)},mounted(){this.errors={},console.log("页面挂载完成，表单数据:",this.registerForm)},methods:{updateUsername(e){this.registerForm.username=e.detail.value||e.target.value||"",this.errors.username=""},updateEmail(e){this.registerForm.email=e.detail.value||e.target.value||"",this.errors.email=""},updatePassword(e){this.registerForm.password=e.detail.value||e.target.value||"",this.errors.password=""},updateConfirmPassword(e){this.registerForm.confirmPassword=e.detail.value||e.target.value||"",this.errors.confirmPassword=""},validateForm(){return this.errors={},this.registerForm.username.trim()?this.registerForm.username.length<3?this.errors.username="用户名至少需要3个字符":/^[a-zA-Z0-9_\u4e00-\u9fa5]+$/.test(this.registerForm.username)||(this.errors.username="用户名只能包含字母、数字、下划线和中文"):this.errors.username="请输入用户名",this.registerForm.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.registerForm.email)||(this.errors.email="请输入有效的邮箱地址"):this.errors.email="请输入邮箱",this.registerForm.password?this.registerForm.password.length<6&&(this.errors.password="密码至少需要6个字符"):this.errors.password="请输入密码",this.registerForm.confirmPassword?this.registerForm.password!==this.registerForm.confirmPassword&&(this.errors.confirmPassword="两次输入的密码不一致"):this.errors.confirmPassword="请确认密码",0===Object.keys(this.errors).length},async handleRegister(){if(this.validateForm()){this.isLoading=!0;try{const e=await t({url:w("/auth/register"),method:"POST",header:{"Content-Type":"application/json"},data:{username:this.registerForm.username.trim(),email:this.registerForm.email.trim(),password:this.registerForm.password,confirmPassword:this.registerForm.confirmPassword}});console.log("注册响应:",e);const r=e.data;if(200!==e.statusCode&&201!==e.statusCode)throw 400===e.statusCode?new Error(r.message||"请求数据有误"):new Error("网络请求失败");if(!r.success)throw new Error(r.message||"注册失败");o("token",r.data.token),o("user",r.data.user),i({title:"注册成功",icon:"success"}),setTimeout(()=>{s({url:"/pages/profile/index"})},1500)}catch(e){console.error("注册失败:",e),i({title:e.message||"注册失败，请重试",icon:"none",duration:2e3})}finally{this.isLoading=!1}}},goToLogin(){a()},goBack(){s({url:"/pages/profile/index"})}}},[["render",function(s,a,t,o,i,w){const _=d,F=l,k=p,v=h;return n(),e(F,{class:"container"},{default:r(()=>[u(F,{class:"back-btn",onClick:w.goBack},{default:r(()=>[u(_,{class:"back-icon"},{default:r(()=>[c("←")]),_:1})]),_:1},8,["onClick"]),u(F,{class:"register-header"},{default:r(()=>[u(F,{class:"app-title"},{default:r(()=>[c("岁月镜像")]),_:1}),u(F,{class:"app-subtitle"},{default:r(()=>[c("开始记录您的人生故事")]),_:1})]),_:1}),u(F,{class:"register-form"},{default:r(()=>[u(F,{class:"form-title"},{default:r(()=>[c("创建账号")]),_:1}),u(F,{class:"input-group"},{default:r(()=>[u(F,{class:"input-container"},{default:r(()=>[u(k,{class:f(["input-field",{error:i.errors.username}]),type:"text",placeholder:"请输入用户名",value:i.registerForm.username,onInput:w.updateUsername,autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false"},null,8,["value","onInput","class"])]),_:1}),i.errors.username?(n(),e(_,{key:0,class:"error-text"},{default:r(()=>[c(g(i.errors.username),1)]),_:1})):m("",!0)]),_:1}),u(F,{class:"input-group"},{default:r(()=>[u(F,{class:"input-container"},{default:r(()=>[u(k,{class:f(["input-field",{error:i.errors.email}]),type:"email",placeholder:"请输入邮箱",value:i.registerForm.email,onInput:w.updateEmail,autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false"},null,8,["value","onInput","class"])]),_:1}),i.errors.email?(n(),e(_,{key:0,class:"error-text"},{default:r(()=>[c(g(i.errors.email),1)]),_:1})):m("",!0)]),_:1}),u(F,{class:"input-group"},{default:r(()=>[u(F,{class:"input-container"},{default:r(()=>[u(k,{class:f(["input-field",{error:i.errors.password}]),type:"password",placeholder:"请输入密码",value:i.registerForm.password,onInput:w.updatePassword,autocomplete:"new-password",autocorrect:"off",autocapitalize:"off",spellcheck:"false"},null,8,["value","onInput","class"])]),_:1}),i.errors.password?(n(),e(_,{key:0,class:"error-text"},{default:r(()=>[c(g(i.errors.password),1)]),_:1})):m("",!0)]),_:1}),u(F,{class:"input-group"},{default:r(()=>[u(F,{class:"input-container"},{default:r(()=>[u(k,{class:f(["input-field",{error:i.errors.confirmPassword}]),type:"password",placeholder:"请确认密码",value:i.registerForm.confirmPassword,onInput:w.updateConfirmPassword,autocomplete:"new-password",autocorrect:"off",autocapitalize:"off",spellcheck:"false"},null,8,["value","onInput","class"])]),_:1}),i.errors.confirmPassword?(n(),e(_,{key:0,class:"error-text"},{default:r(()=>[c(g(i.errors.confirmPassword),1)]),_:1})):m("",!0)]),_:1}),u(F,{class:"btn-container"},{default:r(()=>[u(v,{class:"register-btn",onClick:w.handleRegister,disabled:i.isLoading},{default:r(()=>[c(g(i.isLoading?"注册中...":"注册"),1)]),_:1},8,["onClick","disabled"])]),_:1}),u(F,{class:"form-footer"},{default:r(()=>[u(_,{class:"login-text"},{default:r(()=>[c("已有账号？")]),_:1}),u(_,{class:"login-link",onClick:w.goToLogin},{default:r(()=>[c("立即登录")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})}],["__scopeId","data-v-998e7a6a"]]);export{F as default};
